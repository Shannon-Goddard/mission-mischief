<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lambda Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #000; color: #fff; }
        .result { background: #1a1a1a; padding: 15px; border-radius: 8px; margin: 10px 0; }
        .success { border-left: 4px solid #04aa6d; }
        .error { border-left: 4px solid #ff4444; }
        button { background: #04aa6d; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin: 5px; }
        button:hover { background: #036b4d; }
        pre { background: #2a2a2a; padding: 10px; border-radius: 4px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>üß™ Mission Mischief Lambda Test</h1>
    <p>Testing AWS Lambda endpoint connectivity and CORS configuration</p>
    
    <button onclick="testLambda()">Test Lambda Endpoint</button>
    <button onclick="testCORS()">Test CORS</button>
    <button onclick="clearResults()">Clear Results</button>
    
    <div id="results"></div>
    
    <script>
        const LAMBDA_ENDPOINT = 'https://imddm6sh0i.execute-api.us-east-1.amazonaws.com/prod/scrape';
        
        function addResult(title, content, isError = false) {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = `result ${isError ? 'error' : 'success'}`;
            div.innerHTML = `
                <h3>${title}</h3>
                <pre>${content}</pre>
                <small>Time: ${new Date().toLocaleTimeString()}</small>
            `;
            results.appendChild(div);
            results.scrollTop = results.scrollHeight;
        }
        
        async function testLambda() {
            addResult('üöÄ Testing Lambda Endpoint', 'Starting request...');
            
            try {
                const response = await fetch(LAMBDA_ENDPOINT, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                addResult('üì° Response Status', `Status: ${response.status} ${response.statusText}`);
                
                const responseText = await response.text();
                addResult('üìÑ Response Body', responseText);
                
                if (response.ok) {
                    try {
                        const data = JSON.parse(responseText);
                        addResult('‚úÖ Lambda Success', JSON.stringify(data, null, 2));
                    } catch (e) {
                        addResult('‚ö†Ô∏è JSON Parse Error', e.message, true);
                    }
                } else {
                    addResult('‚ùå Lambda Error', `HTTP ${response.status}: ${responseText}`, true);
                }
                
            } catch (error) {
                addResult('üí• Network Error', error.message, true);
                console.error('Lambda test error:', error);
            }
        }
        
        async function testCORS() {
            addResult('üåê Testing CORS', 'Sending OPTIONS request...');
            
            try {
                const response = await fetch(LAMBDA_ENDPOINT, {
                    method: 'OPTIONS',
                    headers: {
                        'Origin': window.location.origin,
                        'Access-Control-Request-Method': 'GET',
                        'Access-Control-Request-Headers': 'Content-Type'
                    }
                });
                
                const headers = {};
                for (let [key, value] of response.headers.entries()) {
                    headers[key] = value;
                }
                
                addResult('üîß CORS Headers', JSON.stringify(headers, null, 2));
                
                if (response.ok) {
                    addResult('‚úÖ CORS Success', 'CORS preflight passed');
                } else {
                    addResult('‚ùå CORS Failed', `Status: ${response.status}`, true);
                }
                
            } catch (error) {
                addResult('üí• CORS Error', error.message, true);
                console.error('CORS test error:', error);
            }
        }
        
        function clearResults() {
            document.getElementById('results').innerHTML = '';
        }
        
        // Auto-test on load
        document.addEventListener('DOMContentLoaded', function() {
            addResult('üéØ Mission Mischief Lambda Tester', 'Ready to test AWS Lambda endpoint');
        });
    </script>
</body>
</html>